<div class="bg-[#1a1627] rounded-xl shadow-lg hover:shadow-purple-500/20 transition-all duration-300 hover:scale-[1.02] relative border border-white/5 group overflow-hidden"
     [ngClass]="compact ? 'p-4 min-h-0' : 'p-6 min-h-[220px]'"
     (dblclick)="edit.emit(challenge)"
     (contextmenu)="delete.emit({event: $event, challenge: challenge})">

  <span class="badge shadow-xl transition-all"
        [ngClass]="[categoryClass, compact ? 'text-[10px] px-2 py-1 top-2 right-2 min-w-[60px]' : 'text-xs sm:text-sm px-4 py-1.5 top-4 right-4 min-w-[90px]']">
    {{ challenge.category }}
  </span>

  <h4 class="font-bold text-white group-hover:text-purple-400 transition-colors mb-1"
      [ngClass]="compact ? 'text-lg pr-16' : 'text-xl mb-2'">
    {{ challenge.title }}
  </h4>

  <p *ngIf="!compact" class="text-gray-400 mb-14 text-sm line-clamp-3">
    {{ challenge.description }}
  </p>

  <div class="flex items-center justify-between"
       [ngClass]="compact ? 'mt-3' : 'absolute bottom-4 left-6 right-4'">

    <span class="text-xs text-gray-500 italic truncate max-w-[80px]">
      by {{ challenge.createdBy }}
    </span>

    <div class="flex items-center gap-2">
      <div class="text-sm font-semibold bg-gradient-to-r from-purple-400 to-blue-500 text-white px-2 py-1 rounded-full shadow-md"
           [ngClass]="compact ? 'text-xs' : ''">
        {{ challenge.points }} pts
      </div>

      <button *ngIf="compact && ['ACCEPTED', 'IN_PROGRESS'].includes(status || '')"
              (click)="continue.emit(challenge); $event.stopPropagation()"
              class="p-1.5 rounded-full bg-green-600 hover:bg-green-500 text-white shadow-lg transition-transform hover:scale-110"
              title="Resume Challenge">
        <lucide-icon [img]="icons.Play" class="w-4 h-4 fill-current"></lucide-icon>
      </button>

      <ng-container *ngIf="!compact">

        <button *ngIf="!status" (click)="start.emit(challenge); $event.stopPropagation()"
                class="px-4 py-1.5 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold text-sm hover:brightness-110 hover:scale-105 transition-all">
          Start üöÄ
        </button>

        <button *ngIf="status === 'COMPLETED'" (click)="restart.emit(challenge); $event.stopPropagation()"
                class="px-4 py-1.5 rounded-full bg-gray-700/50 hover:bg-gray-600 text-gray-300 border border-white/10 font-medium text-sm transition-all flex items-center gap-2"
                title="Start Again">
          <span>Redo</span>
          <lucide-icon name="rotate-ccw" class="w-4 h-4"></lucide-icon>
        </button>

        <div *ngIf="['PENDING', 'RECEIVED', 'ACCEPTED', 'IN_PROGRESS'].includes(status || '')"
             class="px-3 py-1.5 text-xs text-purple-200 font-bold border border-purple-500/50 rounded-full bg-purple-900/40">
          <span class="animate-pulse text-purple-400">‚óè</span> Active
        </div>

        <button (click)="assign.emit(challenge); $event.stopPropagation()"
                class="p-2 rounded-full bg-gray-800 text-purple-400 hover:bg-purple-500 hover:text-white transition-all shadow-md">
          <span>‚úàÔ∏è</span>
        </button>
      </ng-container>
    </div>
  </div>
</div>
