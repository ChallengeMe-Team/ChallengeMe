<nav>

  <!-- 1. LEFT: Create Challenge Button-->
  <div class="flex-shrink-0 z-10">
    <button (click)="onCreateChallenge()" class="btn-create">
      <lucide-icon [img]="icons.PlusCircle" class="w-5 h-5"></lucide-icon>
      <span>Create Challenge</span>
    </button>
  </div>

  <!-- 2. CENTER: Navigation Menu -->
  <div class="absolute left-1/2 transform -translate-x-1/2 hidden md:flex items-center gap-4">
    <button *ngFor="let link of navLinks"
            (click)="onNavigate(link.page)"
            class="nav-btn"
            [class.active]="currentPage === link.page">
      {{ link.label }}
    </button>
  </div>

  <!-- 3. RIGHT: User Profile -->
  <div class="ml-auto relative z-10">

    <!-- Area that opens the menu-->
    <div (click)="toggleDropdown()"
         class="flex items-center gap-4 cursor-pointer p-2 rounded-xl border border-transparent transition select-none user-profile-container group">

      <!-- Text Info (Vertical) -->
      <div class="hidden md:flex flex-col items-end">
        <span class="text-white font-bold text-base group-hover:text-purple-300 transition">{{ username }}</span>
        <div class="flex items-center gap-2 text-xs">
          <span class="text-gray-400 font-semibold uppercase tracking-wider">Lvl {{ userLevel || 1 }}</span>
          <span class="text-yellow-400 font-bold bg-yellow-400/10 px-2 py-0.5 rounded border border-yellow-400/20">ğŸ† {{ userPoints }} XP</span>
        </div>
      </div>

      <!-- Avatar -->
      <div class="relative">
        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center text-white font-bold text-lg shadow-lg border-2 border-gray-700 group-hover:border-purple-500 transition">
          {{ userInitials }}
        </div>
        <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-[#14121b] rounded-full"></div>
      </div>

      <!-- Icon Dropdown -->
      <lucide-icon [img]="icons.ChevronDown" class="w-5 h-5 text-gray-500 group-hover:text-white transition-transform duration-200" [class.rotate-180]="isDropdownOpen"></lucide-icon>
    </div>

    <!-- Dropdown Menu -->
    <div *ngIf="isDropdownOpen"
         class="absolute right-0 top-full mt-2 w-64 dropdown-menu animate-fade-in origin-top-right">

      <!-- Header Mobile Only -->
      <div class="px-4 py-3 border-b border-gray-700/50 bg-gray-800/30 md:hidden">
        <p class="text-white font-bold">{{ username }}</p>
        <p class="text-xs text-yellow-400">ğŸ† {{ userPoints }} XP</p>
      </div>

      <div class="p-2 space-y-1">
        <button (click)="onNavigate('profile')" class="dropdown-item">
          <lucide-icon [img]="icons.User" class="w-4 h-4"></lucide-icon>
          <span>My Profile</span>
        </button>

        <button (click)="onNavigate('my-challenges')" class="dropdown-item">
          <lucide-icon [img]="icons.FileText" class="w-4 h-4"></lucide-icon>
          <span>My Challenges</span>
        </button>

        <button (click)="onNavigate('friends')" class="dropdown-item">
          <lucide-icon [img]="icons.Users" class="w-4 h-4"></lucide-icon>
          <span>Friends</span>
        </button>

        <button (click)="onNavigate('settings')" class="dropdown-item">
          <lucide-icon [img]="icons.Settings" class="w-4 h-4"></lucide-icon>
          <span>Settings</span>
        </button>
      </div>

      <div class="border-t border-gray-700/50 p-2 mt-1">
        <button (click)="onLogout()" class="dropdown-item" style="color: #f87171;">
          <lucide-icon [img]="icons.LogOut" class="w-4 h-4"></lucide-icon>
          Log Out
        </button>
      </div>
    </div>

  </div>

  <!-- Mobile Menu Button -->
  <button class="md:hidden ml-auto text-white p-2" (click)="isMenuOpen = !isMenuOpen">
    <lucide-icon [img]="icons.Menu" class="w-7 h-7"></lucide-icon>
  </button>

</nav>
