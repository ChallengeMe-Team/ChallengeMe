<nav>
  <div class="flex-shrink-0 z-10">
    <a routerLink="/" class="flex items-center gap-3 group">
      <div class="w-10 h-10 bg-gradient-to-tr from-purple-600 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/20 group-hover:shadow-purple-500/40 transition-all">
        <lucide-icon [img]="icons.Swords" class="w-6 h-6 text-white"></lucide-icon>
      </div>
      <span class="text-xl font-black tracking-tighter text-white hidden lg:block uppercase nav-brand-glow">
        Challenge<span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">Me</span>
      </span>
    </a>
  </div>

  <div class="absolute left-1/2 transform -translate-x-1/2 hidden md:flex items-center gap-6">
    <a *ngFor="let link of navLinks"
       [routerLink]="link.path"
       routerLinkActive="active"
       [routerLinkActiveOptions]="{exact: link.path === '/'}"
       class="nav-btn-optimized cursor-pointer">
      {{ link.label }}
    </a>
  </div>

  <div class="ml-auto relative z-10 flex items-center gap-6">

    <div class="relative">
      <button (click)="toggleNotifications()"
              [class.bell-shake]="unreadCount() > 0"
              class="relative p-2 text-gray-400 hover:text-white transition rounded-full hover:bg-white/10">
        <lucide-icon [img]="icons.Bell" class="w-6 h-6"></lucide-icon>

        <span *ngIf="unreadCount() > 0"
              class="absolute top-1 right-1 flex h-3.5 w-3.5 items-center justify-center rounded-full bg-red-600 text-[9px] font-bold text-white border-2 border-[#14121b] unread-pulse">
    {{ unreadCount() }}
  </span>
      </button>

      <app-notification-dropdown
        *ngIf="isNotificationsOpen"
        (stateChanged)="onStateRefresh()">
      </app-notification-dropdown>
    </div>

    <div class="relative">
      <div (click)="toggleDropdown()" class="flex items-center gap-4 cursor-pointer p-2 rounded-2xl transition select-none group hover:bg-white/5">
        <div class="hidden md:flex flex-col items-end gap-1.5">
          <div class="flex items-center gap-2">
            <span class="text-white font-black text-lg group-hover:text-purple-300 transition-colors">{{ username }}</span>
            <lucide-icon [img]="icons.ChevronDown" class="w-4 h-4 text-gray-500 group-hover:text-white transition-transform duration-200" [class.rotate-180]="isDropdownOpen"></lucide-icon>
          </div>
          <div class="flex items-center gap-2">
            <span class="lvl-badge">LVL {{ userLevel }}</span>
            <span class="xp-badge">üèÜ {{ userPoints }} XP</span>
          </div>
          <div class="w-full max-w-[150px] h-1 bg-white/10 rounded-full overflow-hidden border border-white/5">
            <div class="h-full bg-gradient-to-r from-purple-500 via-blue-400 to-purple-500 transition-all duration-1000" [style.width.%]="userPoints % 100"></div>
          </div>
        </div>

        <div class="relative">
          <div class="w-12 h-12 rounded-full flex items-center justify-center shadow-xl border-2 border-gray-700 group-hover:border-purple-500 transition overflow-hidden bg-gradient-to-br from-purple-600 to-blue-600">
            <img *ngIf="user()?.avatar" [src]="'/avatars/' + user().avatar" class="w-full h-full object-cover" alt="Avatar">
            <span *ngIf="!user()?.avatar" class="text-white font-black text-lg">{{ userInitials }}</span>
          </div>
          <div class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-[#14121b] rounded-full shadow-md"></div>
        </div>
      </div>

      <div *ngIf="isDropdownOpen"
           class="absolute right-0 top-full mt-3 w-60 bg-[#1e1b2e] border border-gray-700 rounded-xl shadow-2xl overflow-hidden z-50 animate-fade-in origin-top-right">
        <div class="p-2 space-y-1">
          <a [routerLink]="['/profile']" (click)="isDropdownOpen = false" class="dropdown-item">
            <lucide-icon [img]="icons.User" class="w-4 h-4"></lucide-icon> <span>My Profile</span>
          </a>
          <a [routerLink]="['/my-challenges']" (click)="isDropdownOpen = false" class="dropdown-item">
            <lucide-icon [img]="icons.FileText" class="w-4 h-4"></lucide-icon> <span>My Challenges</span>
          </a>
          <a [routerLink]="['/friends']" (click)="isDropdownOpen = false" class="dropdown-item">
            <lucide-icon [img]="icons.Users" class="w-4 h-4"></lucide-icon> <span>Friends</span>
          </a>
          <a [routerLink]="['/settings']" (click)="isDropdownOpen = false" class="dropdown-item">
            <lucide-icon [img]="icons.Settings" class="w-4 h-4"></lucide-icon> <span>Settings</span>
          </a>
        </div>
        <div class="border-t border-gray-700/50 p-2 mt-1">
          <button (click)="onLogout()" class="dropdown-item" style="color: #f87171;">
            <lucide-icon [img]="icons.LogOut" class="w-4 h-4"></lucide-icon> Log Out
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>
