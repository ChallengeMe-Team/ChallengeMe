<div class="leaderboard-container">

  <h1 class="title">Leaderboard</h1>

  <div *ngIf="isLoading()" class="flex justify-center mb-4">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"></div>
  </div>

  <div class="flex justify-center mb-12">
    <div class="bg-slate-800 p-1 rounded-full inline-flex border border-slate-700">

      <button (click)="setRange(RangeType.WEEKLY)"
              class="range-btn"
              [class.active]="currentRange() === RangeType.WEEKLY">
        Weekly
      </button>

      <button (click)="setRange(RangeType.MONTHLY)"
              class="range-btn"
              [class.active]="currentRange() === RangeType.MONTHLY">
        Monthly
      </button>

      <button (click)="setRange(RangeType.LAST_6_MONTHS)"
              class="range-btn"
              [class.active]="currentRange() === RangeType.LAST_6_MONTHS">
        Last 6 Months
      </button>

      <button (click)="setRange(RangeType.ALL_TIME)"
              class="range-btn"
              [class.active]="currentRange() === RangeType.ALL_TIME">
        All Time
      </button>

    </div>
  </div>


  <div *ngIf="leaderboardEntries().length > 0" class="podium-wrapper animate-podium">

    <div *ngIf="leaderboardEntries()[1] as second" class="podium-item second-place">
      <div class="rank text-slate-400 opacity-20 text-4xl font-black absolute bottom-0">2</div>

      <div class="avatar-podium">
        <img *ngIf="second.avatar"
             [src]="second.avatar"
             (error)="second.avatar = null"
             alt="Avatar">
        <span *ngIf="!second.avatar">{{ second.username.charAt(0) | uppercase }}</span>
      </div>

      <div class="podium-name">{{ second.username }}</div>
      <div class="podium-points">{{ second.totalPoints }} XP</div>
    </div>

    <div *ngIf="leaderboardEntries()[0] as first" class="podium-item first-place">
      <div class="crown">üëë</div>
      <div class="rank text-yellow-500 opacity-20 text-5xl font-black absolute bottom-0">1</div>

      <div class="avatar-podium ring-4 ring-yellow-400">
        <img *ngIf="first.avatar"
             [src]="first.avatar"
             (error)="first.avatar = null"
             alt="Avatar">
        <span *ngIf="!first.avatar">{{ first.username.charAt(0) | uppercase }}</span>
      </div>

      <div class="podium-name text-lg">{{ first.username }}</div>
      <div class="podium-points text-yellow-200">{{ first.totalPoints }} XP</div>

      <div *ngIf="first.username === currentUser()?.username"
           class="absolute -top-16 w-full text-center text-[10px] font-bold text-yellow-400 animate-bounce tracking-widest">
        THIS IS YOU!
      </div>
    </div>

    <div *ngIf="leaderboardEntries()[2] as third" class="podium-item third-place">
      <div class="rank text-orange-900 opacity-20 text-4xl font-black absolute bottom-0">3</div>

      <div class="avatar-podium">
        <img *ngIf="third.avatar"
             [src]="third.avatar"
             (error)="third.avatar = null"
             alt="Avatar">
        <span *ngIf="!third.avatar">{{ third.username.charAt(0) | uppercase }}</span>
      </div>

      <div class="podium-name">{{ third.username }}</div>
      <div class="podium-points">{{ third.totalPoints }} XP</div>
    </div>

  </div>


  <table class="leaderboard-table">
    <thead>
    <tr>
      <th class="w-16 text-center">#</th>
      <th>Player</th>
      <th class="text-right">XP Points</th>
    </tr>
    </thead>
    <tbody>

    <ng-container *ngFor="let entry of leaderboardEntries(); let i = index">
      <tr *ngIf="i > 2"
          class="table-row"
          [class.current-user-row]="entry.username === currentUser()?.username">

        <td class="text-center font-bold text-slate-400 text-lg">
          {{ entry.rank }}
        </td>

        <td>
          <div class="table-player">
            <div class="avatar-small">
              <img *ngIf="entry.avatar"
                   [src]="entry.avatar"
                   (error)="entry.avatar = null"
                   alt="Avatar">
              <span *ngIf="!entry.avatar">{{ entry.username.charAt(0) | uppercase }}</span>
            </div>

            <div class="flex items-center">
              <span class="font-semibold text-slate-200">{{ entry.username }}</span>

              <span *ngIf="entry.username === currentUser()?.username" class="you-tag">
                  YOU
                </span>
            </div>
          </div>
        </td>

        <td class="text-right">
          <span class="points">{{ entry.totalPoints }} XP</span>
        </td>

      </tr>
    </ng-container>

    <tr *ngIf="leaderboardEntries().length === 0 && !isLoading()">
      <td colspan="3" class="text-center py-10 text-slate-500 italic">
        Be the first to join the leaderboard!
      </td>
    </tr>

    </tbody>
  </table>

</div>


<div *ngIf="!isUserInTopList()" class="sticky-footer">
  <div class="sticky-content">

    <div class="flex items-center gap-4">
      <span class="text-slate-400 font-bold text-xl w-8 text-center">
        {{ myRankData() ? '#' + myRankData()?.rank : '-' }}
      </span>

      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-purple-600 border-2 border-purple-400 flex items-center justify-center overflow-hidden shadow-lg shadow-purple-500/30">
          <img *ngIf="myRankData()?.avatar || currentUser()?.avatar as userAvatar"
               [src]="userAvatar"
               (error)="myRankData() ? myRankData()!.avatar = null : null"
               class="w-full h-full object-cover">

          <span *ngIf="!(myRankData()?.avatar || currentUser()?.avatar)" class="text-white font-bold">
             {{ currentUser()?.username?.charAt(0) | uppercase }}
           </span>
        </div>

        <div>
          <p class="text-white font-bold text-sm">That's You!</p>
          <p class="text-[10px] text-purple-300 uppercase tracking-wide font-bold">
            {{ myRankData() ? 'Keep Pushing üöÄ' : 'Complete a challenge to join! ‚öîÔ∏è' }}
          </p>
        </div>
      </div>
    </div>

    <div class="text-right">
      <span class="block text-2xl font-bold text-white font-mono">
        {{ myRankData() ? myRankData()?.totalPoints : (currentUser()?.points || 0) }}
      </span>
      <span class="text-[10px] text-purple-400 uppercase font-bold tracking-widest">Total XP</span>
    </div>

  </div>
</div>
