<section class="p-10 text-white space-y-12 animate-in fade-in duration-500">
  <h2 class="text-5xl font-extrabold text-center bg-clip-text text-transparent bg-gradient-to-r from-purple-400 via-fuchsia-500 to-blue-500 mb-12">
    Explore Challenges
  </h2>

  <div *ngFor="let difficulty of difficultyKeys" class="space-y-8">
    <div *ngIf="getChallengesByDifficulty(difficulty).length > 0">
      <div class="flex items-center gap-4 mb-6">
        <h3 class="text-xl font-bold uppercase tracking-[0.2em] text-gray-400">
          {{ difficulty }}
        </h3>
        <div class="h-[1px] flex-grow bg-gradient-to-r from-gray-700 to-transparent"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <app-challenge-card
          *ngFor="let challenge of getChallengesByDifficulty(difficulty)"
          [challenge]="challenge"
          [status]="userChallengeStatuses().get(challenge.id)"
          (start)="handleStart($event)"
          (restart)="handleRestart($event)"
          (assign)="handleAssign($event)"
          (edit)="handleEdit($event)"
          (delete)="handleDeleteRequest($event)">
        </app-challenge-card>
      </div>
    </div>
  </div>

  <div *ngIf="challenges().length === 0 && !isLoading()" class="py-20 text-center">
    <div class="text-6xl mb-4">üîç</div>
    <p class="text-gray-500 text-xl font-medium">No quests available at the moment...</p>
  </div>
</section>

<app-challenge-form *ngIf="isEditModalOpen()" [mode]="'edit'" [challengeData]="editChallenge()" (cancel)="isEditModalOpen.set(false)" (submitChallenge)="onChallengeUpdated($event)"></app-challenge-form>
<app-challenge-form *ngIf="challengeService.isCreateModalOpen()" [mode]="'create'" (cancel)="challengeService.isCreateModalOpen.set(false)" (submitChallenge)="onCreateChallenge($event)"></app-challenge-form>
<app-toast *ngIf="toastMessage()" [message]="toastMessage()!" [type]="toastType()"></app-toast>

<div *ngIf="isDeleteModalOpen()" class="fixed inset-0 flex items-center justify-center bg-black/80 z-[100] backdrop-blur-md transition-all">
  <div class="bg-[#1a1627] border border-white/10 p-10 rounded-3xl shadow-2xl w-full max-w-md text-center scale-up-center">
    <div class="w-20 h-20 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6 text-3xl">‚ö†Ô∏è</div>
    <h3 class="text-2xl font-bold text-white mb-2">Delete Quest?</h3>
    <p class="text-gray-400 mb-8">This action cannot be undone. Are you sure?</p>
    <div class="flex justify-center gap-4">
      <button (click)="isDeleteModalOpen.set(false)" class="flex-1 px-6 py-3 rounded-xl bg-gray-800 text-white font-semibold hover:bg-gray-700 transition-colors">Cancel</button>
      <button (click)="confirmDelete()" class="flex-1 px-6 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-500 transition-colors shadow-lg shadow-red-900/20">Delete</button>
    </div>
  </div>
</div>

<app-accept-challenge-modal [isVisible]="isAcceptModalOpen" [challengeTitle]="selectedChallengeForContract?.title" (close)="isAcceptModalOpen = false" (confirm)="onContractSigned($event)"></app-accept-challenge-modal>
<app-assign-challenge-modal [isVisible]="isAssignModalOpen" (close)="isAssignModalOpen = false" (friendSelected)="onFriendAssigned($event)"></app-assign-challenge-modal>
<app-confirmation-modal [isVisible]="isRestartModalOpen" title="Restart Quest?" message="Are you sure you want to start this challenge again? Your previous history will be reset." confirmText="Yes, Restart" cancelText="Cancel" type="warning" (close)="isRestartModalOpen = false" (confirm)="confirmRestart()"></app-confirmation-modal>
