<div *ngIf="isLoading()" class="fixed inset-0 z-[100] bg-[#0b0716] flex flex-col items-center justify-center">
  <div class="w-16 h-16 border-4 border-purple-500/20 border-t-purple-500 rounded-full animate-spin"></div>
  <p class="mt-4 text-purple-400 font-medium animate-pulse">Loading your legend...</p>
</div>

<div class="home-master-wrapper" [class.opacity-0]="isLoading()">

  <div class="hero-gradient-animation"></div>
  <div class="trophy-pattern"></div>

  <div class="relative z-10 transition-opacity duration-700 pointer-events-auto">

    <section class="relative min-h-[85vh] flex flex-col items-center justify-center overflow-hidden py-20 px-4 mt-8 reveal-on-scroll">
      <div class="relative z-20 max-w-5xl mx-auto text-center space-y-8">
        <div class="space-y-4">
          <span class="inline-flex items-center px-6 py-3 text-base font-bold text-white bg-indigo-700/40 backdrop-blur-md border-2 border-indigo-500/30 rounded-full shadow-[0_0_20px_rgba(99,102,241,0.3)] animate-pulse">
            <lucide-icon [img]="zapIcon" class="w-5 h-5 mr-2 text-yellow-400"></lucide-icon>
            Turn Your Goals Into Games
            </span>

          <h1 class="text-6xl md:text-8xl font-black text-white leading-tight epic-glow">
            Transform Tasks Into <br>
            <span class="text-transparent bg-clip-text gradient-hero">Epic Challenges</span>
          </h1>
        </div>

        <div class="max-w-3xl mx-auto glass-card rounded-3xl p-2 shadow-2xl transition-transform hover:scale-[1.01]">
          <app-hero-section></app-hero-section>
        </div>

        <div class="flex flex-wrap justify-center gap-6 pt-4">
          <button
            (click)="onStartChallenge()"
            class="btn-action btn-start">
            <lucide-icon [img]="icons.PlusCircle" class="w-5 h-5"></lucide-icon>
            New Challenge
          </button>

          <button
            (click)="onExploreChallenges()"
            class="btn-action btn-explore">
            Explore World
          </button>
        </div>
      </div>
    </section>

    <section class="max-w-7xl mx-auto -mt-20 relative z-30 px-4 mb-24 reveal-on-scroll delay-100">
      <app-stats-grid></app-stats-grid>
    </section>

    <section class="max-w-7xl mx-auto px-4 pb-20 reveal-on-scroll delay-200">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 glass-card rounded-2xl p-1">
          <div class="lg:col-span-2 glass-card rounded-2xl p-1">
            <app-active-challenges (openPortal)="handleOpenCompletion($event)"></app-active-challenges>
          </div>
        </div>
        <div class="lg:col-span-1 glass-card rounded-2xl p-1">
          <app-badge-showcase></app-badge-showcase>
        </div>
      </div>
    </section>

  </div>
</div>

<app-complete-challenge-modal
  [isVisible]="isCompletionModalVisible"
  [challengeTitle]="selectedChallengeForCompletion?.mappedChallenge?.title || ''"
  [xpReward]="selectedChallengeForCompletion?.mappedChallenge?.points || 0"
  (close)="isCompletionModalVisible = false"
  (confirmCompletion)="handleClaimSuccess()">
</app-complete-challenge-modal>
